<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>로그인 테스트</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript">
	// 페이지 로딩이 완료되고, jQuery 스크립트 실행된다
	$(document).ready(function() {
		
		// 엔터키 입력시 이벤트
		$("#password").on("keyup", function(key) {
			if(key.keyCode == 13) {//키가 13이면 실행 (엔터는 13)
				// 로그인 함수
				login();
			}
		});
		
		// 로그인 버튼을 클릭할때 이벤트 발생
		$("#login_button").on("click", function(e) {
			login();
		});
		
		// 유저추가 버튼 클릭 이벤트
		$("#addUser").on("click", function(e) {
			location.href='/addUser';
		});
		
		// 유저리스트 버튼 클릭 이벤트
		$("#userList").on("click", function(e) {
			location.href='/userList';
		});

	});
	
	// 로그인 함수
	function login() {
		
		if(!fn_PreLogin()) {
			return ;
		}
		
		var sendData = {
        	"id" : $("#id").val(),
        	"password" : $("#password").val()
		};
		
		$.ajax({
		    url : "/login",
		    type : "POST",
		    dataType : "json",
		    cache : false,
		    data : JSON.stringify(sendData),
		    contentType:"application/json",
		    success : function(data) {
				if(data.length >= 1) {
					location.href='/main';
				} else {
					alert("아이디와 비밀번호를 확인해 주세요");
				}
			},
		    error : function(data, status, error) {
		    	var errorData = JSON.parse(data.responseText);
		    	alert(errorData.errorCode + " " + errorData.errorMsg);
		    }
		});
	};
	
	fn_PreLogin = function() {
			
		if(gfn_isNull($("#id").val())) {
			alert("아이디를 입력하세요");
			return false;
		}
			
		if(gfn_isNull($("#password").val())) {
			alert("비밀번호를 입력하세요");
			return false;
		}
			
		if($("#password").val().length < 4) {
			alert("비밀번호는 네자리 이상 입력해 주세요");
			return false;
		}
			
		return true;
	};
	
	/** null 체크*/
	var gfn_isNull = function(obj) {
		if(obj == undefined) {
			return true;
		} else if(obj == null) {
			return true;
		} else if(obj === null) {
			return true;
		} else if(typeof obj == "string") {
			if(obj === "") {
				return true;
			}
		} else if(typeof obj == "object") {
			if(obj.length == 0) {
				return true;
			}
		}
		return false;
	};
	
</script>
	<h1>로그인</h1>
	<br>
	<form method="post" action="/login">
		<table>
			<tr>
				<td><label>아이디</label></td>
				<td><input type="text" id="id" name="id" /></td>
			</tr>
			<tr>
				<td><label>비밀번호</label></td>
				<td><input type="password" id="password" name="password" /></td>
			</tr>
		</table>
		<button id="login_button" type="button">로그인</button>
		<button id="addUser" type="button">회원가입</button>
		<button id="userList" type="button">유저목록</button>
	</form>
</body>
</html>